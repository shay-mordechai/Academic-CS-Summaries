## מערכת ניטור מזג האוויר - חלק 4 (OOPDE-W11Lec22)
המצגת הזו מוסיפה את הדרישות האחרונות למערכת ופותרת אותן באמצעות תבנית עיצוב נוספת.

---

### אתגר מס' 1: שמירת היסטוריה וערכי קיצון

הדרישות החדשות (שקף 5):

1. היסטוריה: המערכת צריכה לאפשר למשתמש לצפות בהיסטוריית המדידות של 24 השעות האחרונות.
    
2. ערכי קיצון (Min/Max): בכל יום בחצות, המערכת צריכה לחשב ולשמור את ערכי המינימום והמקסימום של היממה שחלפה.
    
3. Persistence (שמירה קבועה): יש לשמור את הנתונים האלה בזיכרון בלתי נדיף, כדי שהמידע לא יאבד אם המכשיר יכבה.
    

העיצוב הראשוני (שקפים 8-18): הפתרון הראשוני מציג מחלקה בשם HiLoDataImp שאחראית על כל הלוגיקה: היא מקבלת עדכונים מהחיישן, מחשבת את ערכי הקיצון, וגם אחראית על השמירה והשליפה מהזיכרון הקבוע.

הבעיה בעיצוב הזה: (תשפה ב א 12)

במקרה הבוחן של WMS, הבעיה הייתה שמחלקת HiLoDataImp (שהייתה אחראית על חישוב המינימום/מקסימום) הייתה אחראית גם על שמירת הנתונים לזיכרון בלתי נדיף (Persistence). עיצוב זה הפר את עקרון ה-SRP, כיוון שלמחלקה היו שתי סיבות להשתנות: שינוי באלגוריתם החישוב, או שינוי בשיטת השמירה.

הפתרון עם Proxy: תבנית Proxy שימשה כפתרון. נוצרה מחלקת HiLoDataProxy שהיא זו שאחראית אך ורק על ההיבט הטכני של השמירה (Persistence)
- האובייקט האמיתי (HiLoDataImp) "נוקה" מכל הקוד שקשור לשמירה ונשאר אחראי רק על לוגיקת החישוב.
    
- ה-Proxy פועל כמתווך בין שכבת ה-Policy (האלגוריתם) לשכבת ה-Persistence (שמירה לדיסק), ובכך מפריד את שתי האחריויות הללו.
    

לכן, המטרה של הוספת Proxy במקרה זה הייתה לשמור על SRP (באמצעות הפרדת אחריות החישוב מאחריות השמירה).

### התיקון: תבנית Proxy (שליח/מתווך)

כדי לפתור את הבעיה הזו ולהפריד אחריויות, המצגת מציגה שימוש בתבנית Proxy.

איך זה עובד כאן (שקפים 24-27)?

1. האובייקט האמיתי (RealSubject): המחלקה HiLoDataImp "מנוקה" מכל הקוד שקשור לשמירה. היא נשארת אחראית רק על חישוב המינימום והמקסימום.
    
2. הפרוקסי (Proxy): יוצרים מחלקה חדשה HiLoDataProxy שמממשת את אותו הממשק (HiLoData). הלקוח חושב שהוא מדבר עם מחשבון המינימום/מקסימום, אבל הוא בעצם מדבר עם הפרוקסי.
    
3. הוספת האחריות הנוספת:
    

- הפרוקסי מחזיק בפנים רפרנס לאובייקט האמיתי (HiLoDataImp).
    
- כשהלקוח קורא למתודה כמו currentReading(), הפרוקסי: א. מעביר את הקריאה לאובייקט האמיתי כדי שיבצע את החישוב. ב. מקבל את התשובה. ג. מוסיף את ההתנהגות החדשה: מבצע את פעולת השמירה לדיסק (store()).
    

התוצאה: יצרנו הפרדת אחריויות מושלמת.

- HiLoDataImp אחראי רק על הלוגיקה העסקית.
    
- HiLoDataProxy אחראי רק על ההיבט הטכני של השמירה.
    

זהו שימוש קלאסי בתבנית Proxy כדי להוסיף התנהגות (במקרה הזה, שמירה קבועה) לאובייקט קיים בצורה שקופה ללקוח.

---

בזה סיימנו את הניתוח של כל ארבע מצגות ה-WMS! ראינו איך מערכת פשוטה התפתחה למערכת מורכבת וגמישה באמצעות שימוש הדרגתי בתבניות עיצוב רבות.

  

כיצד נראה העיצוב לפני ההוספה

כיצד נראה העיצוב לאחר ההוספה

### תבנית עיצוב: Proxy (שליח/מתווך)

הבעיה שהתבנית פותרת: אתה רוצה לספק תחליף או "מתווך" לאובייקט אחר כדי לשלוט בגישה אליו. זה שימושי למגוון מטרות, כמו:

- Lazy Initialization (פרוקסי וירטואלי): יצירת אובייקט "יקר" רק כאשר באמת צריך אותו.
    
- בקרת גישה (פרוקסי מגן): בדיקת הרשאות לפני שמאפשרים גישה לאובייקט המקורי.
    
- ניהול זיכרון/רשת (פרוקסי מרוחק/חכם): הסתרת המורכבות של תקשורת עם אובייקט מרוחק או ניהול שמירה לדיסק.
    

### המבנה ב-UML

  

איך זה עובד במערכת מזג האוויר (OOPDE-W11Lec22, שקפים 21-25)?

- האובייקט האמיתי (RealSubject): זו המחלקה HiLoDataImp, שמכילה את הלוגיקה הפשוטה של חישוב מינימום/מקסימום.
    
- הפרוקסי (Proxy): זו המחלקה HiLoDataProxy. היא מממשת את אותו הממשק כמו HiLoDataImp. הלקוח חושב שהוא מדבר עם מחשבון המינימום/מקסימום, אבל הוא בעצם מדבר עם הפרוקסי.
    
- הפעולה הנוספת: הפרוקסי מוסיף את הלוגיקה של שמירה לזיכרון בלתי נדיף (Persistence). הוא מקבל קריאה, מעביר אותה לאובייקט האמיתי (itsImp.currentReading(...)), וכאשר הוא מקבל תשובה, הוא דואג לשמור את התוצאה לדיסק.
    

כך, הפרדנו את האחריות: HiLoDataImp אחראי רק על החישוב, ו-HiLoDataProxy אחראי רק על ניהול השמירה.

### ההבדל בין Bridge ל-Proxy:

הם נראים דומים ב-UML, אבל הכוונה שונה:

- Bridge: מטרתו לנתק בין ממשק למספר מימושים אפשריים.
    
- Proxy: מטרתו לשלוט בגישה למימוש אחד ספציפי.
    

---

### שאלות על תבנית Proxy

תבנית זו עוסקת במתן שליטה על הגישה לאובייקט אחר.

- מבחן תשפ"ג, סמסטר א', מועד ב', שאלה 14:
    

- נושא: זיהוי הבעיה ש-Proxy פותר במערכת מזג האוויר.
    
- תיאור: "מה הבעיה שניסינו לפתור כשהשתמשנו בתבנית Proxy במקרה הבוחן תחנת מזג האוויר?" (התשובה היא שהפרדנו את לוגיקת השמירה לדיסק מהלוגיקה של חישוב המינימום/מקסימום).
    

- מבחן תשפ"ג, סמסטר ב', מועד א', שאלה 11:
    

- נושא: זיהוי כללי של Proxy.
    
- תיאור: "איזו תבנית עיצוב מייצרת מבנה של אובייקט שמהווה אמצעי בקרה לגישה לאובייקט פנימי?"
    

- מעבדה 12 (WMS3-4), שקף 7 (שאלה 3):
    

- נושא: זיהוי שימוש ב-Proxy כמנגנון Cache.
    
- תיאור: מתארים מערכת עם פעולה יקרה, ורוצים להוסיף שכבת Cache שתשמור תוצאות ותחסוך זמן. איזו תבנית מתאימה? (זהו שימוש קלאסי ב-Virtual Proxy).
    

- מבחן תשפ"ב, סמסטר א', מועד א', שאלה פתוחה (סעיף ג'):
    

- נושא: מימוש Protection Proxy.
    
- תיאור: מבקשים להוסיף "שכבת הגנה" למערכת SecretKeeper שמונעת גישה אליה בשעות מסוימות. זהו מימוש קלאסי של Protection Proxy.
    

### כיצד נראה העיצוב לפני ההוספה

  

### כיצד נראה העיצוב לאחר ההוספה

  

---

המלצה: השאלות על Proxy ו-Bridge במערכת מזג האוויר הן קריטיות. נראה שהמבחנים אוהבים לבדוק את ההבנה של למה השתמשנו בתבניות האלה בהקשר הספציפי של ה-WMS.

שאלות ממבחנים:

תשפג א א שאלה 1 (זיהוי Proxy בתרשים משולב עם Composite ו-Decorator).

תשפב א א שאלה 5ג (הגבלת גישה ל-SecretKeeper בשעות מסוימות).

תשפג ב ב שאלה 10 (הבעיה שניסינו לפתור בשימוש ב-Proxy במערכת מזג האוויר: הפרדת קוד אלגוריתם מקוד שמירת נתונים).

תשפה ב א שאלה 12 (המחלקה עליה הוספת התבנית מונעת גישה ישירה).

תשפד ב א שאלה 9 (סידור תבניות: Composite, Decorator, Proxy).

תשפג ב א שאלה 11 (מייצר מבנה אובייקט שהוא אמצעי בקרה לגישה לאובייקט פנימי).




## 6. Proxy Pattern (מתווך)

Proxy היא תבנית עיצוב **מבנית**.

### מטרה ויישום (Persistence)

התבנית נוספה כדי לפתור דרישה חדשה: חישוב ושמירה של ערכי קיצון יומיים (Hi/Lo Data).

- **הבעיה שנפתרה:** העיצוב הראשוני של הוספת הלוגיקה לחישוב (האלגוריתם) ושמירת הנתונים (Persistence) במחלקה אחת (`HiLoDataImp`) הפר את **SRP**.
- **הפתרון:** הפרוקסי משמש כמתווך בין שכבת **האלגוריתם (Policy)** לבין שכבת **שמירת הנתונים לזיכרון הלא נדיף (Persistence)**.
- **הפעולה:** ה-Proxy עוטף את מחשבון ה-Hi/Lo הטהור, ומטרתו היא **להוסיף את הלוגיקה של השמירה** לדיסק בכל פעם שמתבצע עדכון של ערך קיצון.
- **המשאב הנשלט:** ה-Proxy מונע גישה ישירה ל**אלגוריתם** הקיצון.

---

**מערכת ניטור מזג האוויר** היא נושא קריטי שמשלב את התבניות: **Template Method, Observer, Bridge, Abstract Factory, Singleton,** ו-**Proxy**.

---

שאלות ממבחנים על מזג אוויר:

תשפד א ב שאלה 7 (הוספת TemperatureTrendSensor ושימוש ב-Observer).

תשפד א ב שאלה 3 (שימוש ב-Abstract Factory לאתחול).

תשפד א ב שאלה 12 (שינוי עיצובי מ-"תרשים א" ל-"תרשים ב" וניתוק תלויות חומרה).

תשפד ב א שאלה 10 (תבניות עיצוב בשימוש בתרשים השעון: Bridge ו-Observer).

תשפד ב א שאלה 8 (חשיפת מחלקות/ממשקים למהנדסי חומרה לפני ואחרי שינוי Bridge).

תשפג ב ב שאלה 1 (ייעול קוד תיאום ב-Observer/Method Reference).

תשפג ב ב שאלה 10 (Proxy ופתרון בעיות עיצוב).

תשפד א א שאלה 3 (ניתוק תלות בין Scheduler ל-MonitoringScreen, הפרות SRP/DIP/ISP).

תשפב א א שאלה 3 (עיצוב השעון עם Bridge).

תשפב א א שאלה 4 (זיהוי מחלקות שהן צרכניות וספקיות שירותים: PressureTrendSensor ו-AlarmClock).


---
**קודם:** [[Abstract Factory]]
**הבא:** [[טלפון סלולרי]]

**חזרה ל:** [[מערכת ניטור מזג אוויר (WMS)]]
**תוכן עניינים ראשי:** [[Summeries/עיצוב/תוכן עניינים]]