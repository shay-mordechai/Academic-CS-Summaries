# רקורסיה פרימיטיבית עם מספר סופי של צעדים אחורה

הגדרת הרקורסיה הפרימיטיבית דורשת שכל ערך חדש יתבסס אך ורק על **ערך קודם אחד**. כאשר פונקציה $f(n)$ תלויה במספר קבוע של ערכים קודמים (למשל, $f(n-1), f(n-2), f(n-3)$), עלינו להשתמש ב**פונקציית עזר (קידוד)** שתארוז את כל המידע הנדרש לתוך ערך בודד.

---

### שיטת העבודה: קידוד זיווגים מקונן (Nested Pairing)

העיקרון הוא ליצור פונקציית עזר $H(n)$ שתחזיק בכל רגע את ה"חלון" של הערכים הנדרשים לחישוב הצעד הבא.

הקידוד הנדרש:

אם אנו זקוקים ל-$k$ ערכים אחורה, נקודד אותם באמצעות זיווגים מקוננים:

$\langle v_1, \langle v_2, \dots, v_k \rangle \rangle$

---

### דוגמה: פונקציה התלויה ב-3 ערכים קודמים

נתונה הפונקציה (מבוסס על מבחן תשע"ד מועד ב', שאלה 2):

$$\begin{cases} f(n)=n & \text{for } n \le 2 \\ f(n) = 2f(n-1) + 3f(n-2) \dot{-} f(n-3) & \text{for } n \ge 3 \end{cases}$$

כדי לחשב את $f(n+1)$ (כלומר את האיבר הבא בסדרה), אנו זקוקים ל-$f(n)$, $f(n-1)$ ו-$f(n-2)$. אלו הם שלושת הערכים האחרונים.

א. הגדרת פונקציית העזר $H(n)$

נגדיר את $H(n)$ שתחזיק שלשה של ערכים עוקבים:

$$H(n) = \langle f(n), \langle f(n+1), f(n+2) \rangle \rangle$$

ב. בסיס הרקורסיה ($n=0$)

נחשב את הערכים ההתחלתיים:

$f(0)=0, f(1)=1, f(2)=2$.

$$H(0) = \langle f(0), \langle f(1), f(2) \rangle \rangle = \langle 0, \langle 1, 2 \rangle \rangle$$

זהו ערך קבוע, ולכן ר"פ.

ג. צעד הרקורסיה: מעבר מ-$H(n)$ ל-$H(n+1)$

אנו רוצים לקבל:

$$H(n+1) = \langle f(n+1), \langle f(n+2), f(n+3) \rangle \rangle$$

1. **חילוץ נתונים:** נשתמש בפונקציות הפיענוח $l(z)$ ו-$r(z)$:
    
    - $f(n) = l(H(n))$
        
    - $f(n+1) = l(r(H(n)))$
        
    - $f(n+2) = r(r(H(n)))$
        
2. חישוב הערך החדש $f(n+3)$:
    
    נציב את הערכים שחילצנו בנוסחת הרקורסיה המקורית (עבור האינדקס $n+3$):
    
    $$f(n+3) = 2 \cdot f(n+2) + 3 \cdot f(n+1) \dot{-} f(n)$$
    
    $$f(n+3) = 2 \cdot r(r(H(n))) + 3 \cdot l(r(H(n))) \dot{-} l(H(n))$$
    
    זוהי הרכבה של פונקציות ר"פ.
    
3. הרכבת השלשה החדשה:
    
    נארוז את הערכים לתוך $H(n+1)$:
    
    $$H(n+1) = \langle f(n+1), \langle f(n+2), f(n+3) \rangle \rangle$$
    
    (כאשר את $f(n+1), f(n+2)$ אנו לוקחים מהחילוץ, ואת $f(n+3)$ מהחישוב).
    

ד. חילוץ הפונקציה המקורית

$$f(n) = l(H(n))$$

לכן $f(n)$ היא ר"פ.

---

### מקרה מיוחד: צמצום היסטוריה אינסופית לסופית

לעיתים פונקציה נראית כתלויה ב**כל** ההיסטוריה (סכום $\sum$), אך ניתן לפשט אותה לתלות במספר סופי של איברים. זיהוי זה חוסך שימוש בקידוד גדל המורכב.

דוגמה (תשע"ט):

$$f(n+2) = \sum_{j=0}^{n} (j+1)^2 \cdot (f(j))^3$$

הזיהוי:

נשווה בין שני איברים עוקבים בסדרה:

- $f(n+2) = \sum_{j=0}^{n} (\dots)$
    
- $f(n+3) = \sum_{j=0}^{n+1} (\dots) = \left[ \sum_{j=0}^{n} (\dots) \right] + \text{האיבר האחרון}$
    

מכאן נובע הקשר הישיר:

$$f(n+3) = f(n+2) + (n+2)^2 \cdot (f(n+1))^3$$

כעת הפונקציה $f(n+3)$ תלויה רק ב-$f(n+2)$ ו-$f(n+1)$. זוהי רקורסיה עם **שני צעדים אחורה**, וניתן לפתור אותה עם פונקציית עזר של זוגות $\langle f(n), f(n+1) \rangle$, ללא צורך בקידוד גדל.