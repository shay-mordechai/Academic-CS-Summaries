
> [פורמט ה]{dir="rtl"}-IP Datagram [הוא המבנה המשמש ללקיחת נתונים לשידור
> על]{dir="rtl"} [גבי רשת מבוססת]{dir="rtl"} IP.
>
> [בהקשר של חבילת פרוטוקולי]{dir="rtl"} TCP/IP, [דאטהגרם מחולקת לשני
> חלקים]{dir="rtl"} [עיקריים: כותרת ה]{dir="rtl"}-IP [והמטען המכיל את
> נתוני]{dir="rtl"} TCP [או]{dir="rtl"} UDP.
>
> ![](image72.png){width="5.916666666666667in"
> height="2.816666666666667in"}
>
> [כותרת ה]{dir="rtl"}-IP [מכילה מידע הדרוש לניתוב ומסירת הנתונים גרמה
> ברחבי]{dir="rtl"} [הרשת.\
> היא]{dir="rtl"} [בגודל]{dir="rtl"} [קבוע של 20 בתים, אך היא יכולה
> להיות גדולה יותר אם ישנן אפשרויות נוספות]{dir="rtl"}.
>
> [שדות:]{dir="rtl"}

-   [כגון כתובות]{dir="rtl"} IP [מקור ויעד.]{dir="rtl"}

-   Version [- האם מדובר ב]{dir="rtl"}IPv4/IPv6[.]{dir="rtl"}

-   [אורך כותרת, סוג שירות.]{dir="rtl"}

-   TTL [- זמן חיים, מציין את המספר המרבי של הקפות (נתבים)
    שהחבילה]{dir="rtl"} [יכולה]{dir="rtl"} [לעבור.\
    זה מופחת בכל נתב כדי למנוע]{dir="rtl"} [לולאות
    אינסופיות]{dir="rtl"}.\
    [בתאוריה, מוגבל ל255 קפיצות כדי למנוע העברת מסגרת סרק לאותו נתב.
    אחרי 255 סיבובים החבילה תיזרק לפח. בפועל, לרוב]{dir="rtl"} TTL [=
    125 (לשלוח לאלסקה צריך כ30 קפיצות).]{dir="rtl"}

-   Payload [מטען/שדה הנתונים -]{dir="rtl"} [נושא את מקטע
    ה]{dir="rtl"}-TCP [או]{dir="rtl"} UDP[.\
    לדוגמה, אם מדובר בנתונים של]{dir="rtl"} TCP, [המטען יכיל את כותרת
    ה]{dir="rtl"}-TCP [ואחריה את נתוני ה]{dir="rtl"}-TCP. [באופן דומה,
    אם]{dir="rtl"} [מדובר בנתונים של]{dir="rtl"} UDP, [המטען יכיל את
    כותרת]{dir="rtl"} UDP [ואחריה את נתוני]{dir="rtl"} UDP.

-   Header Checksum[: ערך בדיקה]{dir="rtl"} [המחושב על פני כותרת
    ה]{dir="rtl"}-IP [כדי לזהות שגיאות במהלך שידור]{dir="rtl"}.

> [כתובות]{dir="rtl"} IP [של מקור ויעד: שדות אלה מכילים את]{dir="rtl"}
> [כתובות ה]{dir="rtl"}-IP [של 32 סיביות של המכשירים השולחים
> והמקבלים]{dir="rtl"}.

-   [אפשרויות: שדה אופציונלי שניתן להשתמש בו כדי לכלול מידע]{dir="rtl"}
    [נוסף או פרמטרי בקרה בכותרת ה]{dir="rtl"}-IP.

> [ ]{dir="rtl"}

-   Type of service[:הגדרת שירותים מהירים יותר כדי שנתבים יתנו לחבילות
    אלה העדפות.]{dir="rtl"} ECN[, בקרת עומסים. היה בשימוש בפרוטוקולים
    אחרים שהן לא]{dir="rtl"} internet[. לכן בד\"כ נראה שדה זה
    כאפסים.]{dir="rtl"}

-   Length [: מציין את]{dir="rtl"} [האורך הכולל של]{dir="rtl"} Datagram
    IP, [כולל נתוני הכותרת והמטען, נמדד בבתים]{dir="rtl"}.

-   Identifier[: שדה של 16]{dir="rtl"} [סיביות המשמש לזיהוי ייחודי של
    נתוני ה]{dir="rtl"}-IP. [זה מסייע בהרכבה מחדש של גרמות]{dir="rtl"}
    [נתונים מפוצלות ביעד]{dir="rtl"}.

-   [דגלים וקיזוז שברים: שדות אלה משמשים לפיצול]{dir="rtl"} IP
    [והרכבה]{dir="rtl"} [מחדש. הם עוזרים בחלוקת דגימות נתונים גדולות
    לשברים קטנים יותר והרכבתם]{dir="rtl"} [מחדש בצורה נכונה
    ביעד]{dir="rtl"}.

> [ ]{dir="rtl"}
>
> [שאלה: **מדוע צריך **]{dir="rtl"}checksum[?\
> תשובה: אמנם הסוויצ\'ים לא משנים את התוכן, אך נתבים כן עלולים לעשות זאת
> (ישנו את כתובות ה]{dir="rtl"}IP [של המקור והיעד).]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [[פירוק לפריגמנטים:]{.underline}]{dir="rtl"}
>
> MTU (Maximum Transmission Unit) [- גודל מקסימלי שראוטר]{dir="rtl"}
> [יכול לשדר ברשת ומתייחס לשכבה 3]{dir="rtl"} [(שכבת הרשת).]{dir="rtl"}
> [זה תלוי בספק שירותי]{dir="rtl"} [האינטרנט, כאשר ברירת המחדל היא
> 1522]{dir="rtl"}.\
> [ ]{dir="rtl"}
>
> ![](Summeries/מבוא%20לרשתות%20מחשבים/media/media/image73.png){width="4.833333333333333in"
> height="3.8833333333333333in"}

-   [Upperlayer]{.underline} [- איזה פרוטוקול הוא מכיל. למשל בשכבה 4,
    שכבת]{dir="rtl"} TCP/UDP[.]{dir="rtl"}

-   [Checksum]{.underline} [-]{dir="rtl"} [זיהוי שגיאות, בשונה משל שכבה
    4 ששם בדקנו את הנתונים החשובים להעברה אמינה, כעת הוא מחושב עבור
    חבילת ה]{dir="rtl"}IP[. זה אומר שאם נתב מזהה]{dir="rtl"} checksum
    [פגום, הוא משמיט את החבילה וכך נוצר חיסכון ברוחב פס.\
    בשונה מ]{dir="rtl"}checksum [של שכבה 4 שחושב בעיקר עבור כותרת
    החבילה. כעת בשכבה 3 הוא מחושב עבור חבילת ה]{dir="rtl"}IP [כולה. נועד
    לבדיקת שגיאות. מארח הקצה, מאמת גם את ה]{dir="rtl"}checksum
    [של]{dir="rtl"} L3 [וגם את של]{dir="rtl"} L4[.]{dir="rtl"}

-   [Destination]{.underline} [- בודק כמה זמן עברה כל חבילה? למה רושמים
    זאת? - דיאגנוסטיקה.]{dir="rtl"}

-   [TTL]{.underline} [-]{dir="rtl"} time to live[, מונה שמופחת על ידי
    כל נתב שהמנה עוברת דרכו ברשת. מטרתו היא למנוע ממנות להסתובב ללא
    הגבלת זמן במקרה של שגיאות ניתוב או לולאות רשת.\
    בעת עדכון ה-]{dir="rtl"}TTL [, אני צריך גם לעדכן את]{dir="rtl"}
    checksum[. זה מבטיח שסכום הבדיקה יישאר תקף כאשר החבילה חוצה את
    הרשת.]{dir="rtl"}

-   [D-flag]{.underline} [-]{dir="rtl"} do not fragemant[: כאשר דגל זה
    מוגדר ל-1, הוא]{dir="rtl"} [מציין]{dir="rtl"} [שאסור]{dir="rtl"}
    [לפצל את החבילה אם היא חורגת מיחידת השידור המקסימלית]{dir="rtl"}
    (MTU) [של קישור רשת לאורך הנתיב אל היעד]{dir="rtl"}.\
    [אם נתב מקבל חבילה עם הגדרת דגל]{dir="rtl"} D [וצריך להעביר אותה
    לרשת עם]{dir="rtl"} MTU [קטן]{dir="rtl"} [יותר, הוא
    יחזיר]{dir="rtl"} [את החבילה וישלח הודעת]{dir="rtl"} Internet
    Control Message Protocol (ICMP) \"Fragmentation Needed\" [בחזרה
    לשולח]{dir="rtl"}.[\
     ]{dir="rtl"}

-   [M-flag]{.underline}[: דגל זה משמש יחד עם השדה]{dir="rtl"} Offset
    Fragment. [כאשר מנה]{dir="rtl"} [מפוצלת, דגל ה]{dir="rtl"}-M [מוגדר
    ל-1 בכל הפרגמנטים מלבד האחרון, מה שמצביע על כך]{dir="rtl"} [שחלקים
    נוספים יגיעו בהמשך. לפרגמנט האחרון יש דגל]{dir="rtl"} M [מוגדר
    ל-0]{dir="rtl"}.[\
     ]{dir="rtl"}

    -   [כאשר שולח רוצה לשלוח חבילה גדולה יותר מה]{dir="rtl"}-MTU [של
        קישור]{dir="rtl"} [רשת, הוא יקבע את דגל ה]{dir="rtl"}-DF [ל-0
        ויאפשר פיצול. אם נתב לאורך הנתיב מקבל]{dir="rtl"} [חבילה גדולה
        יותר מה]{dir="rtl"}-MTU [שלו, הוא יחלק את החבילה לשברים קטנים
        יותר ויעביר]{dir="rtl"} [אותם בנפרד. שדה]{dir="rtl"} Frag Offset
        [עוזר בהרכבה מחדש של השברים ביעד]{dir="rtl"}.

> [ ]{dir="rtl"}

-   [שדה הזיהוי בכותרת ה]{dir="rtl"}-IP [משמש לזיהוי נתוני]{dir="rtl"}
    IP [ייחודי]{dir="rtl"}. [כאשר חבילה מפוצלת, לכל הפרגמנטים יהיה אותו
    ערך זיהוי, המאפשר למקלט לשייך]{dir="rtl"} [את הפרגמנטים ולשחזר את
    החבילה המקורית]{dir="rtl"}.[\
     ]{dir="rtl"}

-   [למרות שחילקנו את]{dir="rtl"} [החבילה]{dir="rtl"}
    [לסיגמנטים]{dir="rtl"} [קטנים יותר, יכול להיות שבדרך יש נתב שלא יכול
    להתמודד]{dir="rtl"} [עם]{dir="rtl"} [סיגמנט]{dir="rtl"} [כזה גדול.
    לכן, אנו מחלקים את]{dir="rtl"} [הסיגמנט]{dir="rtl"} [הזה לשברים
    (פריגמנטים)]{dir="rtl"} [ומעבירים]{dir="rtl"} [לנתב
    הבא]{dir="rtl"}.[\
     ]{dir="rtl"}

```{=html}
<!-- -->
```
-   [שדה]{dir="rtl"} idintify [- מזהה את כל]{dir="rtl"}
    [הפריגמנטים]{dir="rtl"} [ומאפשר הרכבתם מחדש.]{dir="rtl"}

> [[בקורס צריך לדעת לפרק חבילה לפריגמנטים]{.underline}.]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [חשוב:]{dir="rtl"}
>
> *[הרכבה מחדש של מנות מתרחשת רק בקצה המקבל]{dir="rtl"}. [כאשר כל חלקי
> החבילה מגיעים למארח היעד, הם מזוהים באמצעות השדה]{dir="rtl"}
> Identification [ושדה]{dir="rtl"} Fragment Offset, [ולאחר מכן מורכבים
> מחדש לחבילה המקורית]{dir="rtl"}.*
>
> [(למרות שלכאורה היה ניתן לחסוך, שהנתבים עצמם ידווחו שלא הגיע פריגמנט.
> בפועל, רק היעד יכול לדווח שהסיגמנט כולו לא הגיע, ולכן נשלח סיגמנט
> מחדש).]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [[פיצול חבילת]{dir="rtl"} Datagram [של]{dir="rtl"}
> IPv4[:]{dir="rtl"}]{.underline}
>
> [איך מפציל]{dir="rtl"} [סיגמנט אחד לכמה פריגמנטים?]{dir="rtl"}
>
> [אם הדטגרם 4000 בייט.]{dir="rtl"}
>
> MTU [1500.]{dir="rtl"}
>
> ![](image74.png){width="4.791666666666667in"
> height="2.125in"}
>
> [בדוגמא הנ\"ל, הסיגמנט נעטף כדטאגרם, כלומר התווסף אליו
> ה]{dir="rtl"}header [של הדאטגרם.\
> עלינו לזהות את גודל הסיגמנט, ואותו בלבד לפצל (לא את התוספת של
> הדטאגרם).]{dir="rtl"}

-   [מתעלמים מה]{dir="rtl"}header [של ה]{dir="rtl"}datagram [הראשי, הולך
    לפח.]{dir="rtl"}

-   [נחשב כמה פריגמנטים צריך כדי להשתמש בכל המידע שהיה
    בדטאגרם.]{dir="rtl"}

-   [נחלק את ה]{dir="rtl"}TCP data [כלומר את ה]{dir="rtl"}datagram [בעל
    ה]{dir="rtl"}3980 bytes[, ל3 פריגמנטים.]{dir="rtl"}

-   [נשמור לכל פריגמנט, מקום ל]{dir="rtl"}IP header[, כדי שהמקבל ידע
    לחבר בין כולם.]{dir="rtl"}

-   [הראשון עם 1480, השני עם 1480 והשלישי עם 1020.]{dir="rtl"}

-   [נוסיף לכל פריגמנט שיצרנו, עוד 20 בתים (מעצמנו) בשביל
    ההידר.]{dir="rtl"}

> [לאחר הוספה: הראשון 1500, השני 1500, השלישי 1040.]{dir="rtl"}

-   [הראשון עם 1480+20, השני עם 1480+20, שלישי עם 1020+20.]{dir="rtl"}

> [ ]{dir="rtl"}
>
> **[[דגשים לגבי]{dir="rtl"}
> M[,]{dir="rtl"}D[,]{dir="rtl"}offset[:]{dir="rtl"}]{.underline}**

-   [הדגל]{dir="rtl"} M [יהיה 1 בכולם חוץ מהאחרון, כי הוא מרמז לראוטר
    המקבל מתי יש עוד פריגמנטים בדרך אליו.]{dir="rtl"}

-   [הדגל]{dir="rtl"} D [בד\"כ יהיה 0, אלא אם נתון שיש ראוטר בליבת הרשת
    שמחזיק \... חשוב לציין שפיצול גורם לתקורה נוספת בעיבוד
    ה-]{dir="rtl"}CPU [כדי להרכיב מחדש מנות בקצה השני (ולטפל בפרגמנטים
    חסרים).]{dir="rtl"}

> [מתי נגדיר את]{dir="rtl"} D [להיות 1?\
> - כאשר לא נרצה שהצד השני יצטרך להתמודד עם חבילה מפוצלת אלא נעדיף אובדן
> מנות על פני זה. למשל מכשיר]{dir="rtl"} IoT [כמו נורה חכמה או אזעקת
> עשן, ייתכן שאין להם את הקוד או הזיכרון להרכבה מחדש של פרגמנטים, ולכן
> התוכנה המתקשרת איתם תגדיר]{dir="rtl"} DF[.\
> - או כאשר יש הגבלות מסוימות ברשת, הנגרמות אולי מבעיות רוחב פס או
> התנהגות ספציפית של חומת אש.]{dir="rtl"}

-   [ה]{dir="rtl"}ID [של הסיגמנט המקורי, יודבק לכל אחד מהפריגמנטים, כדי
    שידעו לשייך בניהם.]{dir="rtl"}

-   [חישוב]{dir="rtl"} offset[:]{dir="rtl"}

> [עבור הפריגמנט הראשון - תמיד 0.]{dir="rtl"}
>
> [עבור השני - 1480 (גודלו ללא]{dir="rtl"} header[) חלקי 8, **כלומר
> 185**.]{dir="rtl"}
>
> [עבור האחרון - 1480+1480, חלקי 8 כנ\"ל, **כלומר 370**.]{dir="rtl"}
>
> [ה]{dir="rtl"}offset [עוזר ל]{dir="rtl"}reciever [למקם כל פריגמנט
> במקומו המדויק, כפי שהיה בחבילה המקורית (לפני הפיצול).]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [(גודל מקסימלי של]{dir="rtl"} IP datagram [הוא 65535, אך בד\"כ
> ה]{dir="rtl"}MTU [יגביל אותנו לפחות מכך).]{dir="rtl"}
>
> [ ]{dir="rtl"}
>
> [כאשר נדרשת שידור נתונים]{dir="rtl"} [גדול ברשת, ייתכן שיהיה צורך לפצל
> אותו לחתיכות קטנות יותר כדי להתאים ליחידת]{dir="rtl"} [השידור
> המקסימלית]{dir="rtl"} (MTU) [של]{dir="rtl"} [הנתב.]{dir="rtl"}
>
> [תהליך הפיצול כולל חלוקת הנתונים המקורית למקטעים קטנים
> יותר]{dir="rtl"}, [שלכל אחד מהם כותרת]{dir="rtl"} IP [משלו. כותרת
> ה]{dir="rtl"}-IP [של כל קטע שומרת מידע חיוני, בעוד שמטען]{dir="rtl"}
> [הנתונים של כל קטע מכיל חלק מהנתונים המקוריים]{dir="rtl"}.
>
> [ ]{dir="rtl"}
>
> [הסיבה לחלוקת הנתונים המקורית לכותרת ולנתונים היא לאפשר
> שידור]{dir="rtl"} [יעיל והרכבה מחדש של הנתונים ברחבי הרשת]{dir="rtl"}.
> **[על ידי הכללת מידע הכותרת]{dir="rtl"}** [הדרוש בכל
> פרגמנט]{dir="rtl"}, **[נתבים]{dir="rtl"}** [לאורך נתיב
> השידור]{dir="rtl"} **[יכולים]{dir="rtl"} [לעבד ולהעביר את הפרגמנטים
> באופן עצמאי]{dir="rtl"}**. [עם ההגעה ליעד (לנקודת הקצה)]{dir="rtl"},
> [הפרגמנטים מורכבים מחדש בהתבסס על המידע בכותרות ה]{dir="rtl"}-IP [כדי
> לשחזר את ה]{dir="rtl"}-Datagram [המקורי]{dir="rtl"}.
>
> *[ ]{dir="rtl"}*
>
> [ ]{dir="rtl"}
